<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kdt.goohae.mapper.admin.ProductMapper">
    <!-- 상품 테이블 등록 -->
    <insert id="regProduct">
        insert into product(category_code, manager_id, product_name, price, product_info, product_option, discount)
        values(#{categoryCode}, #{managerId}, #{productName}, #{price}, #{productInfo}, #{productOption}, #{discount})
    </insert>

    <!-- 상품 이미지 등록 -->
    <insert id="regProductImg">
        <selectKey keyProperty="productCode" resultType="int" order="BEFORE">
            select product_code from product where product_name = #{productName}
        </selectKey>

        insert into product_image(product_code, product_option, image_path)
        values(#{productCode}, #{productOption}, #{imagePath})
    </insert>

    <!-- 카테고리별 상품 데이터를 위한 join query문 -->
    <select id="getProduct" resultType="GetProductDTO">
        select product.product_code, product.product_name, product.price, product.discount, product_image.image_path
        from product, product_image
        where product.category_code = #{categoryCode}
        and product.product_code = product_image.product_code
        and product_image.image_path like '%-1%'
        order by product.upload_date desc
        limit #{startNum}, #{rowsPerPage}
    </select>
    
    <!-- 카테고리별 상품 전체 데이터 갯수 조회 -->
    <select id="getTotalData" resultType="int">
        select count(*) from product where category_code = #{categoryCode}
    </select>
</mapper>